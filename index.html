<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Mapa semántico – Representación en memes</title>

  <!-- ÚNICA dependencia -->
  <script src="https://cdn.plot.ly/plotly-2.16.1.min.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #ffffff;
      font-family: Arial, sans-serif;
    }

    #plot {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
<div id="plot"></div>

<script>
/* ======================================================
   DATOS – PEGAR AQUÍ EL BLOQUE ORIGINAL `var traces = [...]`
   ====================================================== */

var traces = [
  /* PEGA AQUÍ EXACTAMENTE LOS TRACES EXTRAÍDOS
     DESDE EL HTML ORIGINAL DE COMMUNALYTIC */
];

/* ======================================================
   CONFIGURACIÓN VISUAL (colores Communalytic)
   ====================================================== */

// Guardamos estado original para poder restaurar
const originalOpacity = traces.map(t =>
  t.marker && t.marker.opacity !== undefined ? t.marker.opacity : 1
);

const originalColor = traces.map(t =>
  t.marker && t.marker.color ? t.marker.color : null
);

let highlightedIndex = null;

/* ======================================================
   LAYOUT (ejes y grilla estilo Communalytic)
   ====================================================== */

const layout = {
  title: {
    text: "Mapa semántico – Representación en memes",
    x: 0.5
  },
  scene: {
    xaxis: {
      title: "Dimensión 1",
      showgrid: true,
      gridcolor: "#e6e6e6",
      zeroline: false,
      showticklabels: false
    },
    yaxis: {
      title: "Dimensión 2",
      showgrid: true,
      gridcolor: "#e6e6e6",
      zeroline: false,
      showticklabels: false
    },
    zaxis: {
      title: "Dimensión 3",
      showgrid: true,
      gridcolor: "#e6e6e6",
      zeroline: false,
      showticklabels: false
    }
  },
  margin: { l: 0, r: 0, t: 50, b: 0 },
  showlegend: true
};

/* ======================================================
   HOVER (limpio y estable)
   ====================================================== */

traces.forEach(trace => {
  if (trace.type === "scatter3d" && trace.mode === "markers") {
    trace.hovertemplate =
      `<b>Cluster:</b> ${trace.name}<br>` +
      `%{text}<extra></extra>`;
  }
});

/* ======================================================
   RENDER INICIAL
   ====================================================== */

Plotly.newPlot("plot", traces, layout, {
  responsive: true,
  displaylogo: false
});

/* ======================================================
   INTERACTIVIDAD: HIGHLIGHT POR CLICK
   ====================================================== */

const plotDiv = document.getElementById("plot");

plotDiv.on("plotly_click", function (data) {
  const clickedTraceIndex = data.points[0].curveNumber;

  // Si se vuelve a hacer click en el mismo cluster → reset
  if (highlightedIndex === clickedTraceIndex) {
    highlightedIndex = null;

    traces.forEach((trace, i) => {
      if (trace.marker) {
        trace.marker.opacity = originalOpacity[i];
        if (originalColor[i]) {
          trace.marker.color = originalColor[i];
        }
      }
    });

  } else {
    highlightedIndex = clickedTraceIndex;

    traces.forEach((trace, i) => {
      if (!trace.marker) return;

      if (i === clickedTraceIndex) {
        trace.marker.opacity = 0.9;
      } else {
        trace.marker.opacity = 0.1;
      }
    });
  }

  Plotly.react("plot", traces, layout);
});
</script>

</body>
</html>
